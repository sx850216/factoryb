name: BPB Obfuscation

on: 
  push: { branches: [main] }
  schedule: [{ cron: "0 1 * * *" }]

permissions: contents: write

jobs:
  build:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v4
    
    - uses: actions/setup-node@v4
      with: { node-version: 20, cache: npm }

    - run: |
        npm i -g javascript-obfuscator --unsafe-perm
        curl -sLo origin.js https://raw.githubusercontent.com/bia-pain-bache/BPB-Worker-Panel/main/build/unobfuscated-worker.js

    - run: >
        javascript-obfuscator origin.js -o _worker.js
        --compact --control-flow-flattening
        --dead-code-injection --identifier-names-generator hexadecimal
    
    - uses: stefanzweifel/git-auto-commit-action@v5
      with: { 
        commit_message: "ðŸ”’ Update obfuscated worker",
        branch: main 
      }
